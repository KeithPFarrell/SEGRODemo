# Real-Time Orchestration Timeline Update

## Issue Fixed
The Reporting Cycles page was not updating the orchestration timeline in real-time when clicking "Run Report Now". Users had to navigate away and return to see the progress.

## Solution Implemented

### 1. **Polling Mechanism**
- Added automatic polling that refreshes cycle data every 1.5 seconds during orchestration
- Polling starts when "Run Report Now" is clicked
- Polling automatically stops when orchestration completes (status changes to 'awaiting_verification', 'completed', or 'failed')

### 2. **Auto-Update Selected Cycle**
- Added a useEffect hook that automatically updates the selected cycle whenever the cycles array changes
- This ensures the UI shows the latest data without requiring manual refresh

### 3. **Visual Feedback**
- Added a pulsing indicator that shows "Orchestration in progress... Timeline updating automatically"
- The indicator appears below the action buttons during orchestration
- Button is disabled during orchestration to prevent multiple clicks

### 4. **Cleanup**
- Proper cleanup of the polling interval when component unmounts or orchestration completes
- No memory leaks or lingering timers

## Changes Made

**File: `/home/node/txai-projects/project/src/pages/ReportingCycles.tsx`**

### Added State:
```typescript
const [isOrchestrating, setIsOrchestrating] = useState(false);
const pollingIntervalRef = useRef<number | null>(null);
```

### Added Effects:

1. **Auto-update selected cycle:**
```typescript
useEffect(() => {
  if (selectedCycle) {
    const updated = cycles.find(c => c.id === selectedCycle.id);
    if (updated) {
      setSelectedCycle(updated);
    }
  }
}, [cycles, selectedCycle]);
```

2. **Polling during orchestration:**
```typescript
useEffect(() => {
  if (isOrchestrating) {
    pollingIntervalRef.current = window.setInterval(() => {
      loadCycles();
    }, 1500);
    
    return () => {
      if (pollingIntervalRef.current) {
        window.clearInterval(pollingIntervalRef.current);
      }
    };
  }
}, [isOrchestrating, loadCycles]);
```

3. **Stop polling when complete:**
```typescript
useEffect(() => {
  if (selectedCycle && isOrchestrating) {
    if (selectedCycle.status === 'awaiting_verification' ||
        selectedCycle.status === 'completed' ||
        selectedCycle.status === 'failed') {
      setIsOrchestrating(false);
    }
  }
}, [selectedCycle, isOrchestrating]);
```

### Updated UI:
- Button disabled during orchestration
- Visual indicator showing orchestration progress
- Timeline updates automatically every 1.5 seconds

## Testing

To test the fix:
1. Navigate to "Reporting Cycles" page
2. Select the February 2024 cycle (scheduled cycle)
3. Click "Run Report Now"
4. **Watch the timeline update automatically** as each orchestration step completes
5. Observe the pulsing status indicator
6. Timeline should progress through all steps without requiring navigation

## User Experience

**Before:**
- Click "Run Report Now"
- Timeline doesn't update
- Must navigate to Dashboard or another page
- Return to Reporting Cycles to see updates

**After:**
- Click "Run Report Now"
- Timeline updates automatically every 1.5 seconds
- Visual indicator shows orchestration is in progress
- No navigation required
- Real-time progress tracking
